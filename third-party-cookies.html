<!doctype html>
<html>

<head>
</head>

<body>
    <h1 id="h1"></h1>
    <script>
        const cookieTest = (iFrameUri, callBack) => {
            const messageHandler = (event) => {
                console.log("event", event)
                if (event.data === "3pcSupported" || event.data === "3pcUnsupported") {
                    callBack(event.data);
                    document.body.removeChild(frame);
                    window.removeEventListener("message", messageHandler);
                }
            }

            window.addEventListener("message", messageHandler);
            const frame = document.createElement("iframe")
            frame.src = iFrameUri
            frame.sandbox = "allow-scripts allow-same-origin"
            frame.style = "display:none"
            frame.onload = (e) => {
                frame.contentWindow.postMessage(JSON.stringify({ "test": "cookie" }), "*");
            }
            document.body.appendChild(frame)
        }

        cookieTest("https://chamithrepo.github.io/create-third-party-cookie/", (data) => {
            document.getElementById("h1").innerText = data
            console.log(data)
        })
    </script>
</body>

</html>
